<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#484838" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>BOLT</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="errorBox"></div>

  <div class="app">
    <div class="card">
      <header>
        <div>
          <div class="title">BOLT</div>
          <div class="subtitle" id="subtitle">Local logs • static plan</div>
        </div>
        <div class="pill" id="sessionCount">0 sessions</div>
      </header>

      <div class="stack">
        <button class="btn danger small" id="emergencyResetBtn" style="align-self:flex-start;">⚠️ Reset App</button>

        <div class="two-col">
          <div>
            <label class="muted" for="programSelect">Program</label>
            <select id="programSelect"></select>
          </div>
          <div>
            <label class="muted" for="sessionSelect">Session</label>
            <select id="sessionSelect"></select>
          </div>
        </div>
        <div class="row">
          <input id="search" type="text" placeholder="Search sessions/workouts…" />
        </div>

        <div class="row">
          <button class="btn primary" id="reloadBtn">Reload plan</button>
          <button class="btn" id="openPlanStats" type="button">Plan stats</button>
          <button class="btn danger" id="clearBtn">Clear logs</button>
        </div>

        <div class="timer-box">
          <div class="timer">
            <div class="time" id="timerDisplay">00:00</div>
            <button class="btn small" id="timerStart">Start</button>
            <button class="btn small" id="timerPause">Pause</button>
            <button class="btn small" id="timerReset">Reset</button>
          </div>
          <select id="preset">
            <option value="60">Rest 60s</option>
            <option value="90">Rest 90s</option>
            <option value="120" selected>Rest 120s</option>
            <option value="180">Rest 180s</option>
          </select>
          <input id="customSeconds" type="number" min="5" step="5" placeholder="Custom seconds" />
          <button class="btn small" id="setCustom">Set</button>
        </div>

        <div class="small-note" id="planHint">
          Put your combined program JSON files in <span class="mono">/data</span>.
        </div>

        <div class="row" id="mobileBrowseRow">
          <button class="btn primary" id="openSessions" type="button">Browse sessions</button>
        </div>

        <div class="divider"></div>
        <div class="sessions" id="sessions"></div>

        <div class="footer-actions">
          <button class="btn" id="exportLogs">Export logs (JSON)</button>
          <button class="btn" id="importLogs">Import logs</button>
          <button class="btn" id="exportCSV">Export logs (CSV)</button>
        </div>
        <input id="importFile" type="file" accept=".json,application/json" style="display:none" />
      </div>
    </div>

    <div class="main">
      <div class="card">
        <header>
          <div>
            <div class="title" id="activeTitle">Loading…</div>
            <div class="subtitle" id="activeMeta">—</div>
            <div class="subtitle" id="activeFunFact" style="margin-top:6px;opacity:.9;font-weight:500;color:var(--accent);"></div>
          </div>
          <div class="authBar">
            <div class="pill" id="activePill">—</div>
            <img id="authAvatar" alt="profile" />
            <span class="pill" id="authStatus" style="max-width:260px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">Not signed in</span>
            <button class="btn small primary" id="signInGoogle" type="button">Sign in</button>
            <button class="btn small" id="signOut" type="button" style="display:none">Sign out</button>
          </div>
        </header>
        <div class="content" id="content"></div>
      </div>
    </div>
  </div>

  <div class="drawer" id="drawer" aria-hidden="true">
    <div class="sheet">
      <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;">
        <div style="font-weight:900;">Select a session</div>
        <button class="btn small" id="closeSessions" type="button" style="max-width:120px;">Close</button>
      </div>
      <div class="sessions" id="sessionsDrawer" style="max-height:70vh; overflow:auto;"></div>
    </div>
  </div>

  <div class="drawer" id="planStatsModal" aria-hidden="true">
    <div class="sheet" style="max-height:88vh;">
      <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;">
        <div style="font-weight:900;">Plan stats</div>
        <button class="btn small" id="closePlanStats" type="button" style="max-width:120px;">Close</button>
      </div>

      <div style="margin-top:12px; background:rgba(0,0,0,0.2); padding:10px; border-radius:12px;">
        <label style="font-size:12px; color:var(--muted); display:block; margin-bottom:4px;">Program Start Date (Week 1)</label>
        <div class="row">
          <input type="date" id="programStartDate" style="font-family:var(--mono);" />
          <button class="btn small primary" id="applyStartDate">Auto-Jump</button>
        </div>
        <div class="small-note" style="margin-top:6px;">Sets "Week 1 Day 1". Example: Set to Nov 24 to make Dec 15 start Week 4.</div>
      </div>
      <div class="stats-grid" style="margin-top:10px;">
        <div class="stat"><div class="muted">Total volume</div><div class="statv"><span id="planTotalVolume">0</span> <span class="muted">kg•reps</span></div></div>
        <div class="stat"><div class="muted">Logged sessions</div><div class="statv" id="planLoggedSessions">0</div></div>
        <div class="stat"><div class="muted">Logged sets</div><div class="statv" id="planLoggedSets">0</div></div>
        <div class="stat"><div class="muted">Unique exercises</div><div class="statv" id="planUniqueExercises">0</div></div>
      </div>
      <div class="divider"></div>
      <div class="small-note"><b>Volume by session (top)</b></div>
      <canvas id="planSessionChart" width="900" height="260" style="width:100%;border:1px solid var(--line);border-radius:14px;background:rgba(0,0,0,.18);"></canvas>
      <div class="divider"></div>
      <div class="small-note"><b>Top exercises</b></div>
      <div class="toplist" id="planTopExercises"></div>
    </div>
  </div>

  <div class="drawer" id="historyModal" aria-hidden="true">
    <div class="sheet" style="max-height:80vh;">
      <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;">
        <div style="font-weight:900;" id="historyTitle">History</div>
        <button class="btn small" id="closeHistory" type="button">Close</button>
      </div>
      <div class="divider"></div>
      <div id="historyList" class="sessions" style="overflow:auto;"></div>
    </div>
  </div>

  <div class="drawer" id="plateModal" aria-hidden="true">
    <div class="sheet">
      <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;">
        <div style="font-weight:900;">Plate Math</div>
        <button class="btn small" id="closePlate" type="button">Close</button>
      </div>
      <div class="divider"></div>
      <div style="padding:10px 0;">
        <div class="grid" style="grid-template-columns: 1fr 100px;">
          <label style="align-self:center;">Target Weight (kg)</label>
          <input type="number" id="plateTarget" value="60" style="font-size:18px; font-weight:bold;">
        </div>
        <div class="divider"></div>
        <div id="plateResult" style="text-align:center; font-family:var(--mono); font-size:16px; white-space:pre-wrap; line-height:1.6;"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/idb-keyval@6/dist/index-min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script type="module" src="js/main.js"></script>
</body>
</html>